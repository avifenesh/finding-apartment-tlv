<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>כניסה - מציאת דירות בתל אביב</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
    <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-md">
        <h2 class="text-2xl font-bold text-center mb-6">כניסה למערכת</h2>
        
        <form id="loginForm" class="space-y-4">
            <div>
                <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
                    אימייל
                </label>
                <input 
                    type="email" 
                    id="email" 
                    required
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="הזן אימייל"
                >
            </div>
            
            <div>
                <label for="password" class="block text-sm font-medium text-gray-700 mb-2">
                    סיסמה
                </label>
                <input 
                    type="password" 
                    id="password" 
                    required
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="הזן סיסמה"
                >
            </div>
            
            <div id="errorMessage" class="text-red-500 text-sm hidden"></div>
            
            <button 
                type="submit" 
                class="w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
            >
                כניסה
            </button>
        </form>
    </div>

    <script>
        // Check if already authenticated
        const authToken = sessionStorage.getItem('authToken');
        if (authToken && isValidToken(authToken)) {
            window.location.href = '/index.html';
        }

        function isValidToken(token) {
            try {
                const parts = token.split('.');
                if (parts.length !== 2) return false;
                const payload = JSON.parse(atob(parts[1]));
                return payload.exp > Date.now();
            } catch {
                return false;
            }
        }

        function hashPassword(password) {
            return CryptoJS.SHA256(password).toString();
        }

        function generateToken(email) {
            const header = btoa(JSON.stringify({ alg: 'HS256', typ: 'JWT' }));
            const payload = btoa(JSON.stringify({
                email: hashEmail(email),
                exp: Date.now() + (24 * 60 * 60 * 1000), // 24 hours
                iat: Date.now()
            }));
            return `${header}.${payload}`;
        }

        function hashEmail(email) {
            return CryptoJS.SHA256(email.toLowerCase()).toString();
        }

        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const errorMessage = document.getElementById('errorMessage');
            
            // Hash the inputs
            const emailHash = hashEmail(email);
            const passwordHash = hashPassword(password);
            
            // Check against hashed values (these should ideally come from a secure backend)
            const validEmailHash = '8c4d3e5a6b7f8e9d2a1c4b6e8f9d3a5c7b9e2d4f6a8c1e3b5d7f9a2c4e6b8d0f';
            const validPasswordHash = 'e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855';
            
            // For demo purposes, accept the original credentials
            // In production, this check should be done server-side
            const isValidLogin = (
                email.toLowerCase() === 'REDACTED' && 
                password === 'REDACTED'
            );
            
            if (isValidLogin) {
                // Generate session token
                const token = generateToken(email);
                sessionStorage.setItem('authToken', token);
                sessionStorage.setItem('userEmailHash', emailHash);
                
                // Redirect to main page
                window.location.href = '/index.html';
            } else {
                errorMessage.textContent = 'אימייל או סיסמה שגויים';
                errorMessage.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>